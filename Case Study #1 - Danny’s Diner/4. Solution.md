### üöÄ CASE STUDY QUESTION

#### ‚úç 1: What is the total amount each customer spent at the restaurant?

````sql
-- Question 1: What is the total amount each customer spent at the restaurant?
SELECT 
    customer_id,
    SUM(price) AS 'total_amount'
FROM sales s LEFT JOIN menu m ON s.product_id = m.product_id
GROUP BY customer_id
ORDER BY customer_id;
````
|customer_id|total_amount|
|:----|:----|
|A|76|
|B|74|
|C|36|
_______________________________________________________________________________________________________________________________________________________


#### ‚úç 2. How many days has each customer visited the restaurant?

````sql
-- Question 2. How many days has each customer visited the restaurant?
SELECT 
    customer_id,
    COUNT(DISTINCT order_date) AS 'freq_visit'
FROM sales
GROUP BY customer_id
ORDER BY 2 DESC;

````
|customer_id|freq_visit|
|:----|:----|
|B|6|
|A|4|
|C|2|

_______________________________________________________________________________________________________________________________________________________

#### ‚úç 3. What was the first item from the menu purchased by each customer?

````sql
-- Question 3. What was the first item from the menu purchased by each customer?
WITH sale_rankings AS (
    SELECT 
        customer_id,
        product_name,
        order_date,
        DENSE_RANK() OVER (PARTITION BY customer_id ORDER BY order_date) AS order_rank
    FROM sales s LEFT JOIN menu m ON s.product_id = m.product_id),

temp_view AS (
    SELECT
        customer_id,
        product_name
    FROM sale_rankings
    WHERE order_rank = 1
    GROUP BY customer_id, product_name)

SELECT
    customer_id, 
    STRING_AGG(product_name, ', ') AS products
FROM temp_view
GROUP BY customer_id;
````
|customer_id|products|
|:----|:----|
|A|curry, sushi|
|B|curry|
|C|ramen|

_______________________________________________________________________________________________________________________________________________________

#### ‚úç 4. What is the most purchased item on the menu and how many times was it purchased by all customers?

````sql
-- Question 4. What is the most purchased item on the menu and how many times was it purchased by all customers?
SELECT TOP 1 product_id FROM sales GROUP BY product_id ORDER BY COUNT(*) DESC;

SELECT 
    customer_id, 
    COUNT(*)  AS 'product_count'
FROM sales
WHERE product_id =  (SELECT TOP 1 product_id FROM sales GROUP BY product_id ORDER BY COUNT(*) DESC)
GROUP BY customer_id;

````
|customer_id|product_count|
|:----|:----|
|A|3|
|B|2|
|C|3|

_______________________________________________________________________________________________________________________________________________________

#### ‚úç 3. What was the first item from the menu purchased by each customer?

````sql
-- Question 3. What was the first item from the menu purchased by each customer?
````
|customer_id|products|
|:----|:----|
|A|curry, sushi|
|B|curry|
|C|ramen|

_______________________________________________________________________________________________________________________________________________________

#### ‚úç 3. What was the first item from the menu purchased by each customer?

````sql
-- Question 3. What was the first item from the menu purchased by each customer?
````
|customer_id|products|
|:----|:----|
|A|curry, sushi|
|B|curry|
|C|ramen|

_______________________________________________________________________________________________________________________________________________________

#### ‚úç 3. What was the first item from the menu purchased by each customer?

````sql
-- Question 3. What was the first item from the menu purchased by each customer?
````
|customer_id|products|
|:----|:----|
|A|curry, sushi|
|B|curry|
|C|ramen|

_______________________________________________________________________________________________________________________________________________________

#### ‚úç 3. What was the first item from the menu purchased by each customer?

````sql
-- Question 3. What was the first item from the menu purchased by each customer?

````
|customer_id|products|
|:----|:----|
|A|curry, sushi|
|B|curry|
|C|ramen|
